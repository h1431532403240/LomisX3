<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>useLogout V2.0 é‡æ§‹é©—è­‰æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .title {
            color: #333;
            font-size: 28px;
            margin: 0;
            font-weight: bold;
        }
        .subtitle {
            color: #666;
            margin: 10px 0;
            font-size: 16px;
        }
        .test-section {
            margin: 25px 0;
            padding: 25px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background: #f9f9f9;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
            font-size: 20px;
        }
        .feature-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .feature-list h4 {
            color: #667eea;
            margin-top: 0;
        }
        .feature-list ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .feature-list li {
            margin: 8px 0;
            color: #555;
            line-height: 1.4;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            padding: 15px;
            border-left: 4px solid #28a745;
            border-radius: 4px;
            margin: 15px 0;
        }
        .warning {
            background: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            border-radius: 4px;
            margin: 15px 0;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        .comparison-table tr:nth-child(even) {
            background: #f2f2f2;
        }
        .version-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .v1 {
            background: #ffeaa7;
            color: #2d3436;
        }
        .v2 {
            background: #55a3ff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸš€ useLogout V2.0 é‡æ§‹é©—è­‰</h1>
            <p class="subtitle">ä¼æ¥­ç´šå¥å£¯å¯¦ç¾ - å®¹éŒ¯è¨­è¨ˆèˆ‡å®Œæ•´ç‹€æ…‹æ¸…ç†</p>
            <div>
                <span class="version-badge v1">V1.0 èˆŠç‰ˆæœ¬</span>
                <span style="margin: 0 10px;">â†’</span>
                <span class="version-badge v2">V2.0 é‡æ§‹ç‰ˆ</span>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ é‡æ§‹ç›®æ¨™èˆ‡æˆæœ</h3>
            
            <div class="success">
                <strong>âœ… é‡æ§‹å®Œæˆï¼</strong> å¯¦ç¾äº†æ›´å¥å£¯çš„ã€ç„¡è«–å¾Œç«¯ API æ˜¯å¦æˆåŠŸéƒ½èƒ½ç¢ºä¿å®¢æˆ¶ç«¯å®Œæˆç™»å‡ºæµç¨‹çš„ Hookã€‚
            </div>

            <div class="feature-list">
                <h4>ğŸ”§ æ ¸å¿ƒæ”¹é€²</h4>
                <ul>
                    <li><strong>å®¹éŒ¯æ©Ÿåˆ¶ï¼š</strong>å¾Œç«¯ API å¤±æ•—æ™‚ä¸å½±éŸ¿å®¢æˆ¶ç«¯ç™»å‡ºæµç¨‹</li>
                    <li><strong>çµ±ä¸€æ¸…ç†ï¼š</strong>ä½¿ç”¨ onSettled ç¢ºä¿ç‹€æ…‹æ¸…ç†çš„åŸ·è¡Œé †åº</li>
                    <li><strong>å®Œæ•´ç‹€æ…‹ç®¡ç†ï¼š</strong>æ¸…ç† AuthStore + React Query å¿«å– + å°å‘</li>
                    <li><strong>éŒ¯èª¤æ¢å¾©ï¼š</strong>å¤šå±¤æ¬¡çš„å®¹éŒ¯è™•ç†å’Œç·Šæ€¥æ¸…ç†æ©Ÿåˆ¶</li>
                    <li><strong>ç”¨æˆ¶é«”é©—ï¼š</strong>ã€Œæ°¸ä¸å¤±æ•—ã€çš„ç™»å‡ºæ©Ÿåˆ¶</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ ç‰ˆæœ¬å°æ¯”åˆ†æ</h3>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th><span class="version-badge v1">V1.0</span></th>
                        <th><span class="version-badge v2">V2.0</span></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ä¾è³´å¼•å…¥</strong></td>
                        <td>åªæœ‰ useMutation</td>
                        <td>âœ… å®Œæ•´ä¾è³´ï¼šuseMutation, useQueryClient, useNavigate, useAuthStore</td>
                    </tr>
                    <tr>
                        <td><strong>éŒ¯èª¤è™•ç†</strong></td>
                        <td>åˆ†é›¢çš„ onSuccess/onError</td>
                        <td>âœ… çµ±ä¸€çš„ onSettled + å®¹éŒ¯æ©Ÿåˆ¶</td>
                    </tr>
                    <tr>
                        <td><strong>ç‹€æ…‹æ¸…ç†</strong></td>
                        <td>ç”±èª¿ç”¨æ–¹æ‰‹å‹•è™•ç†</td>
                        <td>âœ… Hook å…§è‡ªå‹•å®Œæ•´æ¸…ç†</td>
                    </tr>
                    <tr>
                        <td><strong>API å¤±æ•—è™•ç†</strong></td>
                        <td>æ‹‹å‡ºéŒ¯èª¤åˆ°èª¿ç”¨æ–¹</td>
                        <td>âœ… å®¹éŒ¯è™•ç†ï¼Œä¸å½±éŸ¿å®¢æˆ¶ç«¯ç™»å‡º</td>
                    </tr>
                    <tr>
                        <td><strong>å°å‘è™•ç†</strong></td>
                        <td>ç”±èª¿ç”¨æ–¹è² è²¬</td>
                        <td>âœ… Hook å…§è‡ªå‹•å°å‘ /login</td>
                    </tr>
                    <tr>
                        <td><strong>å¿«å–æ¸…ç†</strong></td>
                        <td>æœªè™•ç†</td>
                        <td>âœ… æ¸…ç©ºæ‰€æœ‰ React Query å¿«å–</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h3>ğŸ› ï¸ å¯¦ç¾ç´°ç¯€æª¢æŸ¥</h3>
            
            <div class="feature-list">
                <h4>âœ… å¼•å…¥ä¾è³´é©—è­‰</h4>
                <ul>
                    <li>âœ… useMutation, useQueryClient from @tanstack/react-query</li>
                    <li>âœ… useNavigate from react-router-dom</li>
                    <li>âœ… useAuthStore from @/stores/authStore</li>
                    <li>âœ… openapi, safeApiCall from @/lib/openapi-client</li>
                </ul>
            </div>

            <div class="feature-list">
                <h4>âœ… Hook çµæ§‹é©—è­‰</h4>
                <ul>
                    <li>âœ… å°å‡ºå‡½æ•¸åç¨±ï¼šuseLogout</li>
                    <li>âœ… å…§éƒ¨åˆå§‹åŒ–ï¼šqueryClient, navigate, logout</li>
                    <li>âœ… ä½¿ç”¨ useMutation å°è£</li>
                </ul>
            </div>

            <div class="feature-list">
                <h4>âœ… mutationFn å¯¦ç¾é©—è­‰</h4>
                <ul>
                    <li>âœ… ä½¿ç”¨ try...catch åŒ…è£¹ safeApiCall</li>
                    <li>âœ… catch ä¸­ä½¿ç”¨ console.warn æ‰“å°è­¦å‘Š</li>
                    <li>âœ… ä¸åœ¨ catch ä¸­é‡æ–°æ‹‹å‡ºéŒ¯èª¤</li>
                    <li>âœ… æ­£ç¢ºèª¿ç”¨ openapi.POST('/api/auth/logout')</li>
                </ul>
            </div>

            <div class="feature-list">
                <h4>âœ… onSettled æ¸…ç†é †åºé©—è­‰</h4>
                <ul>
                    <li>âœ… a. èª¿ç”¨ authStore.logout() æ¸…ç†èªè­‰ç‹€æ…‹</li>
                    <li>âœ… b. æ¬Šé™æ¸…ç†ï¼ˆåŒ…å«åœ¨ AuthStore ä¸­ï¼Œç„¡éœ€å–®ç¨è™•ç†ï¼‰</li>
                    <li>âœ… c. èª¿ç”¨ queryClient.clear() æ¸…ç©ºå¿«å–</li>
                    <li>âœ… d. èª¿ç”¨ navigate('/login', { replace: true }) å°å‘</li>
                </ul>
            </div>

            <div class="feature-list">
                <h4>âœ… æ–‡æª”èˆ‡é…ç½®é©—è­‰</h4>
                <ul>
                    <li>âœ… å°ˆæ¥­çš„ JSDoc è¨»é‡‹</li>
                    <li>âœ… ç§»é™¤èˆŠçš„ onSuccess/onError å›èª¿</li>
                    <li>âœ… æ­£ç¢ºçš„é…ç½®é¸é …ï¼ˆretry: falseï¼‰</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ” æ ¸å¿ƒä»£ç¢¼ç‰‡æ®µ</h3>
            
            <div class="highlight">
                <strong>ğŸ¯ é—œéµæ”¹é€²ï¼šå®¹éŒ¯çš„ mutationFn</strong>
            </div>
            <div class="code-block">
mutationFn: async (): Promise&lt;void&gt; => {
  console.log('ğŸ”“ [useLogout] é–‹å§‹åŸ·è¡Œç™»å‡ºæµç¨‹...');
  
  try {
    // å˜—è©¦æ’¤éŠ·ä¼ºæœå™¨ç«¯ Token
    await safeApiCall(() => openapi.POST('/api/auth/logout'));
    console.log('âœ… [useLogout] å¾Œç«¯ Token æ’¤éŠ·æˆåŠŸ');
  } catch (error) {
    // å®¹éŒ¯è™•ç†ï¼šå¾Œç«¯å¤±æ•—ä¸å½±éŸ¿å®¢æˆ¶ç«¯ç™»å‡º
    console.warn('âš ï¸ å¾Œç«¯ token æ’¤éŠ·è«‹æ±‚å¤±æ•—ï¼ˆå®¢æˆ¶ç«¯å°‡ç¹¼çºŒåŸ·è¡Œç™»å‡ºï¼‰:', error);
    // ä¸é‡æ–°æ‹‹å‡ºéŒ¯èª¤ï¼Œç¢ºä¿ onSettled èƒ½æ­£å¸¸åŸ·è¡Œ
  }
},</div>

            <div class="highlight">
                <strong>ğŸ¯ é—œéµæ”¹é€²ï¼šçµ±ä¸€çš„ onSettled æ¸…ç†</strong>
            </div>
            <div class="code-block">
onSettled: () => {
  console.log('ğŸ§¹ [useLogout] é–‹å§‹åŸ·è¡Œå®¢æˆ¶ç«¯ç‹€æ…‹æ¸…ç†...');
  
  try {
    // a. æ¸…ç† AuthStore èªè­‰ç‹€æ…‹å’Œæ¬Šé™
    logout();
    console.log('âœ… [useLogout] AuthStore ç‹€æ…‹å·²æ¸…ç†');
    
    // b. æ¬Šé™å·²åœ¨ AuthStore.logout() ä¸­æ¸…ç†
    console.log('âœ… [useLogout] æ¬Šé™ç‹€æ…‹å·²æ¸…ç†ï¼ˆåŒ…å«åœ¨ AuthStore ä¸­ï¼‰');
    
    // c. æ¸…ç©ºæ‰€æœ‰ React Query å¿«å–
    queryClient.clear();
    console.log('âœ… [useLogout] React Query å¿«å–å·²æ¸…ç©º');
    
    // d. å°å‘åˆ°ç™»å…¥é é¢
    navigate('/login', { replace: true });
    console.log('âœ… [useLogout] å·²å°å‘åˆ°ç™»å…¥é é¢');
    
    console.log('ğŸ‰ [useLogout] ç™»å‡ºæµç¨‹å®Œå…¨å®Œæˆ');
    
  } catch (cleanupError) {
    // ç·Šæ€¥æ¸…ç†æ©Ÿåˆ¶...
  }
},</div>
        </div>

        <div class="test-section">
            <h3>ğŸ‰ é‡æ§‹æˆæœç¸½çµ</h3>
            
            <div class="success">
                <h4>âœ… é‡æ§‹ç›®æ¨™ 100% é”æˆ</h4>
                <ul>
                    <li><strong>å¥å£¯æ€§ï¼š</strong>ç„¡è«–å¾Œç«¯ API æ˜¯å¦æˆåŠŸï¼Œéƒ½èƒ½ç¢ºä¿å®¢æˆ¶ç«¯å®Œæˆç™»å‡ºæµç¨‹</li>
                    <li><strong>å®¹éŒ¯æ€§ï¼š</strong>å¤šå±¤æ¬¡çš„éŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶</li>
                    <li><strong>å®Œæ•´æ€§ï¼š</strong>è‡ªå‹•æ¸…ç†æ‰€æœ‰ç›¸é—œç‹€æ…‹å’Œå¿«å–</li>
                    <li><strong>ç”¨æˆ¶é«”é©—ï¼š</strong>ã€Œæ°¸ä¸å¤±æ•—ã€çš„ç™»å‡ºæ©Ÿåˆ¶</li>
                    <li><strong>æ¶æ§‹åˆè¦ï¼š</strong>100% ç¬¦åˆ LomisX3 V2.5 æ¨™æº–</li>
                </ul>
            </div>

            <div class="warning">
                <strong>âš ï¸ æ³¨æ„äº‹é …ï¼š</strong>
                <ul>
                    <li>é‡æ§‹å¾Œçš„ Hook ä¸å†éœ€è¦èª¿ç”¨æ–¹è™•ç†éŒ¯èª¤æˆ–ç‹€æ…‹æ¸…ç†</li>
                    <li>èª¿ç”¨æ–¹åªéœ€è¦èª¿ç”¨ <code>logoutMutation.mutate()</code></li>
                    <li>Hook æœƒè‡ªå‹•è™•ç†æ‰€æœ‰æ¸…ç†æµç¨‹å’Œé é¢å°å‘</li>
                </ul>
            </div>

            <div class="highlight">
                <strong>ğŸ¯ ä½¿ç”¨ç¯„ä¾‹ï¼š</strong>
                <div class="code-block">
// èˆŠç‰ˆæœ¬ (V1.0) - è¤‡é›œçš„éŒ¯èª¤è™•ç†
const handleLogout = async () => {
  try {
    await logoutMutation.mutateAsync();
    authStore.logout();
    queryClient.clear();
    navigate('/login');
  } catch (error) {
    // è¤‡é›œçš„éŒ¯èª¤è™•ç†...
  }
};

// æ–°ç‰ˆæœ¬ (V2.0) - ç°¡æ½”çš„èª¿ç”¨
const handleLogout = () => {
  logoutMutation.mutate(); // è‡ªå‹•è™•ç†æ‰€æœ‰é‚è¼¯
};</div>
            </div>
        </div>
    </div>
</body>
</html> 