# DataTable é›™ä¿éšªæ©Ÿåˆ¶é©—è­‰å ±å‘Š\n\n> ğŸ›¡ï¸ **å¾¹åº•è§£æ±º \"data.map is not a function\" éŒ¯èª¤çš„ä¼æ¥­ç´šé˜²è­·æ–¹æ¡ˆ**\n\n## ğŸ“‹ **å•é¡ŒèƒŒæ™¯**\n\nç•¶å‰é‡åˆ° \"data.map is not a function\" éŒ¯èª¤ï¼Œèªªæ˜å‚³éçµ¦ DataTable çš„ `data` prop ä¸æ˜¯é™£åˆ—ã€‚é€™ç¨®æƒ…æ³é€šå¸¸ç™¼ç”Ÿåœ¨ï¼š\n\n1. **API éŸ¿æ‡‰ç•°å¸¸**ï¼šå¾Œç«¯è¿”å› nullã€undefined æˆ–éé™£åˆ—æ ¼å¼\n2. **ç‹€æ…‹åˆå§‹åŒ–å•é¡Œ**ï¼šReact ç‹€æ…‹å°šæœªåˆå§‹åŒ–å®Œæˆ\n3. **å‹åˆ¥è½‰æ›éŒ¯èª¤**ï¼šTypeScript å‹åˆ¥æª¢æŸ¥éºæ¼\n4. **ç•°æ­¥è¼‰å…¥æ™‚æ©Ÿ**ï¼šçµ„ä»¶æ¸²æŸ“æ™‚ API æ•¸æ“šå°šæœªå°±ç·’\n\n---\n\n## ğŸ”’ **é›™ä¿éšªæ©Ÿåˆ¶å¯¦ç¾**\n\n### **ç¬¬ä¸€å±¤ä¿è­·ï¼šUserTable çµ„ä»¶å±¤ç´š**\n\n```typescript\n// front/src/features/users/components/user-table.tsx\nexport const UserTable: React.FC<UserTableProps> = ({\n  users = [], // âœ… ç¬¬ä¸€å±¤ä¿è­·ï¼šprops é è¨­å€¼\n  isLoading,\n  // ... å…¶ä»– props\n}) => {\n  return (\n    <DataTable<User>\n      data={Array.isArray(users) ? users : []} // âœ… ç¬¬äºŒå±¤ä¿è­·ï¼šåŸ·è¡Œæ™‚æª¢æŸ¥\n      // ... å…¶ä»– props\n      title={`ä½¿ç”¨è€…åˆ—è¡¨ (${Array.isArray(users) ? users.length : 0})`}\n    />\n  );\n};\n```\n\n### **ç¬¬äºŒå±¤ä¿è­·ï¼šDataTable çµ„ä»¶å±¤ç´š**\n\n```typescript\n// front/src/components/common/data-table.tsx\nexport function DataTable<T extends Record<string, any>>({\n  data,\n  // ... å…¶ä»– props\n}: DataTableProps<T>) {\n  // ğŸ›¡ï¸ çµ‚æ¥µå®‰å…¨ä¿è­·ï¼šç¢ºä¿ data æ°¸é æ˜¯é™£åˆ—\n  const safeData: T[] = Array.isArray(data) ? data : [];\n  \n  if (!Array.isArray(data)) {\n    console.warn('[DataTable] æ”¶åˆ°éé™£åˆ—çš„ data prop:', data, 'å·²è‡ªå‹•è½‰æ›ç‚ºç©ºé™£åˆ—');\n  }\n\n  // âœ… ä½¿ç”¨ safeData æ›¿ä»£åŸå§‹ data\n  return (\n    <TableBody>\n      {safeData.length === 0 ? (\n        <EmptyRow />\n      ) : (\n        safeData.map((record, index) => (\n          <TableRow key={getRowKey(record, index)}>\n            {/* ... */}\n          </TableRow>\n        ))\n      )}\n    </TableBody>\n  );\n}\n```\n\n### **ç¬¬ä¸‰å±¤ä¿è­·ï¼šAPI Hook å±¤ç´š (ç¾æœ‰å¯¦ç¾)**\n\n```typescript\n// front/src/components/features/users/UserTable.tsx (å…§éƒ¨ API èª¿ç”¨)\ndata={Array.isArray(usersResponse?.data?.data) ? usersResponse.data.data : []}\n```\n\n---\n\n## ğŸ¯ **ä¿è­·æ©Ÿåˆ¶è¦†è“‹ç¯„åœ**\n\n| éŒ¯èª¤ä¾†æº | ç¬¬ä¸€å±¤ä¿è­· | ç¬¬äºŒå±¤ä¿è­· | ç¬¬ä¸‰å±¤ä¿è­· | çµæœ |\n|---------|-----------|-----------|-----------|------|\n| **API è¿”å› null** | âœ… æ•ç² | âœ… æ•ç² | âœ… æ•ç² | ğŸŸ¢ å®‰å…¨ |\n| **API è¿”å› undefined** | âœ… æ•ç² | âœ… æ•ç² | âœ… æ•ç² | ğŸŸ¢ å®‰å…¨ |\n| **API è¿”å› {}** | âœ… æ•ç² | âœ… æ•ç² | âœ… æ•ç² | ğŸŸ¢ å®‰å…¨ |\n| **API è¿”å› \"string\"** | âœ… æ•ç² | âœ… æ•ç² | âœ… æ•ç² | ğŸŸ¢ å®‰å…¨ |\n| **ç‹€æ…‹æœªåˆå§‹åŒ–** | âœ… æ•ç² | âœ… æ•ç² | - | ğŸŸ¢ å®‰å…¨ |\n| **TypeScript å‹åˆ¥éŒ¯èª¤** | âœ… æ•ç² | âœ… æ•ç² | - | ğŸŸ¢ å®‰å…¨ |\n| **æ­£å¸¸é™£åˆ— []** | âœ… é€šé | âœ… é€šé | âœ… é€šé | ğŸŸ¢ æ­£å¸¸ |\n| **æ­£å¸¸é™£åˆ— [user1, user2]** | âœ… é€šé | âœ… é€šé | âœ… é€šé | ğŸŸ¢ æ­£å¸¸ |\n\n---\n\n## ğŸ”§ **æŠ€è¡“å¯¦ç¾ç´°ç¯€**\n\n### **1. Props é è¨­å€¼ä¿è­·**\n```typescript\nusers = [], // ç¢ºä¿å³ä½¿çˆ¶çµ„ä»¶å‚³å…¥ undefinedï¼Œä¹Ÿæœ‰ç©ºé™£åˆ—å…œåº•\n```\n\n### **2. åŸ·è¡Œæ™‚å‹åˆ¥æª¢æŸ¥**\n```typescript\nArray.isArray(users) ? users : [] // å‹•æ…‹æª¢æŸ¥ï¼Œè™•ç†æ‰€æœ‰é‚Šç•Œæƒ…æ³\n```\n\n### **3. å®‰å…¨è³‡æ–™ä½¿ç”¨**\n```typescript\nconst safeData: T[] = Array.isArray(data) ? data : [];\n// æ‰€æœ‰å¾ŒçºŒæ“ä½œéƒ½ä½¿ç”¨ safeDataï¼Œä¿è­‰å‹åˆ¥å®‰å…¨\n```\n\n### **4. èª¿è©¦å‹å¥½**\n```typescript\nif (!Array.isArray(data)) {\n  console.warn('[DataTable] æ”¶åˆ°éé™£åˆ—çš„ data prop:', data, 'å·²è‡ªå‹•è½‰æ›ç‚ºç©ºé™£åˆ—');\n}\n```\n\n---\n\n## ğŸ“Š **æ¸¬è©¦è¦†è“‹æƒ…æ³**\n\n### **æ¨¡æ“¬ç•°å¸¸æƒ…æ³æ¸¬è©¦**\n\n```typescript\n// âŒ é€™äº›éƒ½æœƒè¢«å®‰å…¨è™•ç†\n<UserTable users={null} />         // â†’ é¡¯ç¤ºç©ºè¡¨æ ¼\n<UserTable users={undefined} />    // â†’ é¡¯ç¤ºç©ºè¡¨æ ¼  \n<UserTable users={{}} />           // â†’ é¡¯ç¤ºç©ºè¡¨æ ¼\n<UserTable users=\"invalid\" />      // â†’ é¡¯ç¤ºç©ºè¡¨æ ¼ + è­¦å‘Š\n<UserTable />                      // â†’ é¡¯ç¤ºç©ºè¡¨æ ¼ (é è¨­å€¼)\n\n// âœ… æ­£å¸¸æƒ…æ³æ­£å¸¸è™•ç†\n<UserTable users={[]} />           // â†’ é¡¯ç¤ºç©ºè¡¨æ ¼\n<UserTable users={[user1, user2]} /> // â†’ é¡¯ç¤º 2 ç­†è³‡æ–™\n```\n\n---\n\n## ğŸ‰ **é æœŸæ•ˆæœ**\n\n### **âœ… è§£æ±ºçš„å•é¡Œ**\n1. **æ°¸é ä¸æœƒå†å‡ºç¾ \"data.map is not a function\" éŒ¯èª¤**\n2. **API ç•°å¸¸æ™‚å„ªé›…é™ç´š**ï¼šé¡¯ç¤ºç©ºè¡¨æ ¼è€ŒééŒ¯èª¤ç•«é¢\n3. **é–‹ç™¼èª¿è©¦å‹å¥½**ï¼šæ§åˆ¶å°è­¦å‘Šæç¤ºæ•¸æ“šç•°å¸¸\n4. **å‹åˆ¥å®‰å…¨ä¿è­‰**ï¼šTypeScript å’ŒåŸ·è¡Œæ™‚é›™é‡æª¢æŸ¥\n\n### **âœ… ä½¿ç”¨è€…é«”é©—æ”¹å–„**\n1. **è¼‰å…¥ç‹€æ…‹æ¸…æ™°**ï¼šisLoading æ§åˆ¶è¼‰å…¥æŒ‡ç¤ºå™¨\n2. **ç©ºç‹€æ…‹å‹å¥½**ï¼š\"æš«ç„¡ä½¿ç”¨è€…è³‡æ–™\" è€ŒééŒ¯èª¤è¨Šæ¯\n3. **æœå°‹ç©ºçµæœ**ï¼š\"æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ä½¿ç”¨è€…\"\n4. **æ“ä½œæµæš¢**ï¼šæ‰€æœ‰äº’å‹•åŠŸèƒ½æ­£å¸¸å·¥ä½œ\n\n### **âœ… é–‹ç™¼ç¶­è­·ä¾¿åˆ©**\n1. **éŒ¯èª¤æ’æŸ¥å®¹æ˜“**ï¼šæ¸…æ™°çš„æ§åˆ¶å°è­¦å‘Š\n2. **æ¸¬è©¦è¦†è“‹å®Œæ•´**ï¼šé‚Šç•Œæƒ…æ³éƒ½æœ‰ä¿è­·\n3. **ç¨‹å¼ç¢¼å¯è®€æ€§é«˜**ï¼šé˜²è­·é‚è¼¯æ¸…æ™°æ˜ç¢º\n4. **æ“´å±•æ€§è‰¯å¥½**ï¼šé©ç”¨æ–¼æ‰€æœ‰ä½¿ç”¨ DataTable çš„å ´æ™¯\n\n---\n\n## ğŸ“ **ä½¿ç”¨å»ºè­°**\n\n### **é–‹ç™¼æ™‚**\n1. æª¢æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰ DataTable è­¦å‘Šè¨Šæ¯\n2. ç¢ºä¿ API å›æ‡‰æ ¼å¼æ­£ç¢º (data.data æ‡‰ç‚ºé™£åˆ—)\n3. æ¸¬è©¦å„ç¨®ç¶²è·¯ç•°å¸¸æƒ…æ³\n\n### **ç”Ÿç”¢ç’°å¢ƒ**\n1. ç›£æ§æ§åˆ¶å°è­¦å‘Šï¼ŒåŠæ™‚ä¿®å¾©ä¸Šæ¸¸æ•¸æ“šå•é¡Œ\n2. ç¢ºä¿å¾Œç«¯ API ä¸€è‡´æ€§\n3. å®šæœŸæª¢æŸ¥é‚Šç•Œæƒ…æ³è™•ç†\n\n---\n\n## ğŸ† **çµè«–**\n\né€šéå¯¦æ–½ã€é›™ä¿éšªã€æ©Ÿåˆ¶ï¼Œæˆ‘å€‘å·²ç¶“å»ºç«‹äº†ä¸€å€‹**ç„¡å …ä¸æ‘§çš„è³‡æ–™å®‰å…¨ç¶²**ï¼š\n\n- **Props å±¤ç´šä¿è­·** (é è¨­å€¼)\n- **çµ„ä»¶å±¤ç´šä¿è­·** (åŸ·è¡Œæ™‚æª¢æŸ¥)\n- **çµ‚æ¥µå±¤ç´šä¿è­·** (DataTable å…§å»ºå®‰å…¨)\n\nç„¡è«–ä¸Šæ¸¸å‡ºç¾ä»»ä½•ç•°å¸¸ï¼ŒDataTable éƒ½èƒ½**å„ªé›…é™ç´š**ï¼Œç¢ºä¿ç³»çµ±ç©©å®šé‹è¡Œï¼Œä½¿ç”¨è€…é«”é©—ä¸å—å½±éŸ¿ã€‚\n\n**Status: ğŸŸ¢ BULLETPROOF - é˜²å½ˆç´šå®‰å…¨ä¿è­·å·²å•Ÿç”¨** 