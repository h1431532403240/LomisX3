<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LomisX3 åˆªé™¤ç”¨æˆ¶èª¿è©¦å·¥å…· V5.3</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” LomisX3 åˆªé™¤ç”¨æˆ¶èª¿è©¦å·¥å…· V5.3</h1>
    
    <div class="debug-section">
        <h2>1. æª¢æŸ¥ç”¨æˆ¶ ID 15 çš„å¯¦éš›ç‹€æ…‹</h2>
        <button onclick="checkUserStatus()">æª¢æŸ¥ç”¨æˆ¶ç‹€æ…‹</button>
        <div id="userStatus"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. åŸ·è¡Œåˆªé™¤ä¸¦ç›£æ§éç¨‹</h2>
        <button onclick="deleteUserWithDebug()">åˆªé™¤ç”¨æˆ¶ ID 15</button>
        <div id="deleteResult"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. åˆªé™¤å¾Œå†æ¬¡æª¢æŸ¥ç‹€æ…‹</h2>
        <button onclick="checkAfterDelete()">åˆªé™¤å¾Œæª¢æŸ¥</button>
        <div id="afterDeleteStatus"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';
        const authToken = localStorage.getItem('auth_token');
        
        if (!authToken) {
            document.body.innerHTML = '<h2 class="error">âŒ æœªæ‰¾åˆ°èªè­‰ Tokenï¼Œè«‹å…ˆç™»å…¥</h2>';
        }

        async function apiCall(method, url, body = null) {
            const options = {
                method,
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            const response = await fetch(url, options);
            const data = await response.json();
            
            return {
                status: response.status,
                ok: response.ok,
                data: data
            };
        }

        async function checkUserStatus() {
            const output = document.getElementById('userStatus');
            output.innerHTML = '<p class="info">ğŸ”„ æª¢æŸ¥ä¸­...</p>';
            
            try {
                // æª¢æŸ¥ç”¨æˆ¶åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨
                const listResult = await apiCall('GET', `${API_BASE}/users?per_page=100`);
                const user15InList = listResult.data.data?.find(u => u.id === 15);
                
                // å˜—è©¦ç›´æ¥ç²å–ç”¨æˆ¶è©³æƒ…
                const detailResult = await apiCall('GET', `${API_BASE}/users/15`);
                
                output.innerHTML = `
                    <h3>ğŸ“Š ç”¨æˆ¶ ID 15 ç‹€æ…‹æª¢æŸ¥ï¼š</h3>
                    <pre>
ç”¨æˆ¶åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨: ${user15InList ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}
${user15InList ? `åˆ—è¡¨ä¸­çš„ç”¨æˆ¶è³‡æ–™: ${JSON.stringify(user15InList, null, 2)}` : ''}

ç›´æ¥ç²å–è©³æƒ…çµæœ: ${detailResult.status} ${detailResult.ok ? 'âœ…' : 'âŒ'}
è©³æƒ…éŸ¿æ‡‰: ${JSON.stringify(detailResult.data, null, 2)}
                    </pre>
                `;
            } catch (error) {
                output.innerHTML = `<p class="error">âŒ æª¢æŸ¥å¤±æ•—: ${error.message}</p>`;
            }
        }

        async function deleteUserWithDebug() {
            const output = document.getElementById('deleteResult');
            output.innerHTML = '<p class="info">ğŸ”„ åŸ·è¡Œåˆªé™¤ä¸­...</p>';
            
            try {
                console.log('ğŸš€ é–‹å§‹åˆªé™¤ç”¨æˆ¶ ID 15');
                const startTime = Date.now();
                
                const result = await apiCall('DELETE', `${API_BASE}/users/15`);
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                output.innerHTML = `
                    <h3>ğŸ—‘ï¸ åˆªé™¤æ“ä½œçµæœï¼š</h3>
                    <pre>
HTTP ç‹€æ…‹ç¢¼: ${result.status}
æ“ä½œæˆåŠŸ: ${result.ok ? 'âœ… æ˜¯' : 'âŒ å¦'}
åŸ·è¡Œæ™‚é–“: ${duration}ms
éŸ¿æ‡‰å…§å®¹: ${JSON.stringify(result.data, null, 2)}
                    </pre>
                `;
                
                // ç¨ç­‰ç‰‡åˆ»è®“ Observer è™•ç†å®Œæˆ
                setTimeout(() => {
                    output.innerHTML += '<p class="info">â³ ç­‰å¾… 2 ç§’è®“ Observer å’Œå¿«å–æ¸…é™¤è™•ç†å®Œæˆ...</p>';
                }, 1000);
                
            } catch (error) {
                output.innerHTML = `<p class="error">âŒ åˆªé™¤å¤±æ•—: ${error.message}</p>`;
            }
        }

        async function checkAfterDelete() {
            const output = document.getElementById('afterDeleteStatus');
            output.innerHTML = '<p class="info">ğŸ”„ æª¢æŸ¥åˆªé™¤å¾Œç‹€æ…‹...</p>';
            
            try {
                // å†æ¬¡æª¢æŸ¥ç”¨æˆ¶åˆ—è¡¨
                const listResult = await apiCall('GET', `${API_BASE}/users?per_page=100`);
                const user15InList = listResult.data.data?.find(u => u.id === 15);
                
                // å˜—è©¦ç›´æ¥ç²å–ç”¨æˆ¶è©³æƒ…
                const detailResult = await apiCall('GET', `${API_BASE}/users/15`);
                
                output.innerHTML = `
                    <h3>ğŸ” åˆªé™¤å¾Œç‹€æ…‹æª¢æŸ¥ï¼š</h3>
                    <pre>
ç”¨æˆ¶æ˜¯å¦é‚„åœ¨åˆ—è¡¨ä¸­: ${user15InList ? 'âŒ ä»ç„¶å­˜åœ¨' : 'âœ… å·²ç§»é™¤'}
${user15InList ? `åˆ—è¡¨ä¸­çš„ç”¨æˆ¶è³‡æ–™: ${JSON.stringify(user15InList, null, 2)}` : ''}

ç›´æ¥ç²å–è©³æƒ…çµæœ: ${detailResult.status}
- 404 è¡¨ç¤ºå·²åˆªé™¤ âœ…
- 200 è¡¨ç¤ºä»å­˜åœ¨ âŒ
è©³æƒ…éŸ¿æ‡‰: ${JSON.stringify(detailResult.data, null, 2)}

ğŸ’¡ åˆ†æï¼š
${!user15InList && detailResult.status === 404 ? 
    'ğŸ‰ åˆªé™¤æˆåŠŸï¼ç”¨æˆ¶å·²å¾åˆ—è¡¨å’Œè³‡æ–™åº«ä¸­ç§»é™¤ã€‚' : 
    'âš ï¸  åˆªé™¤å¯èƒ½å¤±æ•—ï¼Œç”¨æˆ¶ä»ç„¶å­˜åœ¨æ–¼ç³»çµ±ä¸­ã€‚'}
                    </pre>
                `;
            } catch (error) {
                output.innerHTML = `<p class="error">âŒ æª¢æŸ¥å¤±æ•—: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>